<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Midtrans Integration Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="YOUR_CLIENT_KEY"></script>
  <style>
    .error-field { border: 2px solid red; }
    .error-checkbox { outline: 2px solid red; }
  </style>
</head>
<body>
  <form id="paymentForm">
    <input type="text" id="nama_lengkap" placeholder="Nama Lengkap" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="text" id="nomor_telepon" placeholder="Nomor Telepon" required />
    <select id="kategori_lomba" required>
      <option value="" disabled selected>Pilih Kategori Lomba</option>
      <option value="lari">5K</option>
      <option value="jalan">10K</option>
      <option value="jalan21k">21K</option>
    </select>
    <button type="submit" id="submitButton">Beli Tiket</button>
  </form>

  <script>
    document.getElementById('paymentForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const requiredFields = ['nama_lengkap', 'email', 'nomor_telepon', 'kategori_lomba'];
      let errors = [];

      requiredFields.forEach(id => {
        const field = document.getElementById(id);
        if (!field.value.trim()) {
          errors.push(field);
          field.classList.add('error-field');
        } else {
          field.classList.remove('error-field');
        }
      });

      if (errors.length > 0) {
        Swal.fire('Error', 'Harap isi semua field yang diperlukan.', 'error');
        return;
      }

      const data = {
        nama_lengkap: document.getElementById('nama_lengkap').value,
        email: document.getElementById('email').value,
        nomor_telepon: document.getElementById('nomor_telepon').value,
        kategori_lomba: document.getElementById('kategori_lomba').value,
      };

      fetch('http://localhost:3000/create-transaction', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        if (response.token) {
          window.snap.pay(response.token, {
            onSuccess: function(result) {
              Swal.fire('Success', 'Pembayaran berhasil!', 'success');
            },
            onPending: function(result) {
              Swal.fire('Pending', 'Pembayaran sedang diproses.', 'info');
            },
            onError: function(result) {
              Swal.fire('Error', 'Pembayaran gagal.', 'error');
            }
          });
        } else {
          Swal.fire('Error', 'Gagal mendapatkan token pembayaran.', 'error');
        }
      })
      .catch(() => Swal.fire('Error', 'Gagal menghubungi server.', 'error'));
    });
  </script>
</body>
</html>